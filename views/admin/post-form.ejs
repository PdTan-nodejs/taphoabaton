<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= post ? 'Chỉnh sửa bài viết' : 'Tạo bài viết mới' %> - Admin
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="/css/header.css">
    <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
</head>

<body>
    <%- include('../partials/admin-header') %>

        <div class="admin-container">
            <div class="admin-sidebar">
                <ul class="admin-menu">
                    <li><a href="/admin/dashboard">Dashboard</a></li>
                    <li><a href="/admin/posts">Quản lý bài viết</a></li>
                    <li><a href="/admin/pages">Quản lý trang</a></li>
                    <li><a href="/admin/projects">Quản lý dự án</a></li>
                    <li><a href="/">Về trang chủ</a></li>
                    <li><a href="/admin/logout">Đăng xuất</a></li>
                </ul>
            </div>

            <div class="admin-content">
                <h1>
                    <%= post ? 'Chỉnh sửa bài viết' : 'Tạo bài viết mới' %>
                </h1>

                <form action="<%= post ? '/admin/posts/' + post.id : '/admin/posts' %>" method="POST"
                    enctype="multipart/form-data" class="post-form">
                    <div class="form-group">
                        <label for="title">Tiêu đề *</label>
                        <input type="text" id="title" name="title" value="<%= post ? post.title : '' %>" required>
                    </div>

                    <div class="form-group">
                        <label for="categoryId">Danh mục *</label>
                        <select id="categoryId" name="categoryId" required>
                            <option value="">Chọn danh mục</option>
                            <% categories.forEach(category=> { %>
                                <option value="<%= category.id %>" <%=post && post.categoryId===category.id ? 'selected'
                                    : '' %>>
                                    <%= category.name %>
                                </option>
                                <% }); %>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="excerpt">Đoạn trích</label>
                        <textarea id="excerpt" name="excerpt" rows="3"><%= post ? post.excerpt || '' : '' %></textarea>
                    </div>

                    <div class="form-group">
                        <label for="content">Nội dung *</label>
                        <textarea id="content" name="content" required><%= post ? post.content : '' %></textarea>
                    </div>

                    <div class="form-group">
                        <label for="image">Hình ảnh</label>
                        <% if (post && post.image) { %>
                            <div class="current-image">
                                <img src="/uploads/<%= post.image %>" alt="Current image">
                                <p>Ảnh hiện tại</p>
                            </div>
                            <% } %>
                                <input type="file" id="image" name="image" accept="image/*">
                                <small>Chỉ chấp nhận file ảnh (jpg, png, gif, webp), tối đa 5MB</small>
                    </div>

                    <div class="form-group">
                        <label for="status">Trạng thái</label>
                        <select id="status" name="status">
                            <option value="draft" <%=post && post.status==='draft' ? 'selected' : '' %>>Bản nháp
                            </option>
                            <option value="published" <%=post && post.status==='published' ? 'selected' : '' %>>Đã xuất
                                bản</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <%= post ? 'Cập nhật' : 'Tạo mới' %>
                        </button>
                        <a href="/admin/posts" class="btn-secondary">Hủy</a>
                    </div>
                </form>
            </div>
        </div>

        <script>
            CKEDITOR.replace('content', {
                height: 400
            });
        </script>
</body>

</html>